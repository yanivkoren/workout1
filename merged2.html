<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>אימון: 7 טבלאות + טיימר בפופאפ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    body { background:#f7f7f9; }
    .section-card { margin-bottom: 24px; }
    table.table { cursor: pointer; }
    /* --- עיצוב המודאל לנייד --- */
    .modal-fullscreen-sm-down .modal-content { background:#000; color:#fff; }
    .exercise-img-wrap {
      position: relative;
      width: 100%;
      height: calc(100vh - 164px);
      max-height: 75vh; /* בדסקטופ לא חייב מסך מלא */
      background:#000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .exercise-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .controls-bar {
      position: sticky; bottom: 0;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      border-top: 1px solid rgba(255,255,255,0.2);
      padding: .75rem;
    }
    .timer-display {
      font-size: 64px; line-height:1; font-weight: 800; color:#0d6efd;
      text-shadow: 0 0 12px rgba(13,110,253,.35);
    }
    @media (min-width: 992px){
      .timer-display { font-size: 72px; }
    }
    .btn-wide { min-width: 92px; }
    .badge-rounds { font-size: .85rem; }
    .hint { font-size:.85rem; color:#6c757d; }
    .btn-close.btn-close-white { filter: invert(1); }
  </style>
</head>
<body class="py-4">

  <div class="container">
    <h2 class="mb-3">רשימת תרגילים</h2>

    <!-- כאן נייצר 7 כרטיסים (סקשנים) עם טבלה לכל קטגוריה -->
    <div id="sections"></div>

    <p class="hint mt-2 mb-0">לחיצה על שורה פותחת פופאפ עם ה-GIF והטיימר. בנייד הפופאפ נפתח במסך מלא לנוחות אימון.</p>
  </div>

  <!-- Modal: תמונה + טיימר (מלא במסכים קטנים) -->
  <div class="modal fade" id="exerciseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down modal-xl">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="modalTitle">הדגמת תרגיל</h5>
          <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="modal" aria-label="סגור" onclick="onModalClose()"></button>
        </div>

        <!-- אזור תמונה גמיש -->
        <div class="exercise-img-wrap">
          <img id="modalImage" class="exercise-img" src="" alt="תמונה של התרגיל">
        </div>

        <!-- סרגל בקרות דביק בתחתית -->
        <div class="controls-bar">
          <div class="container-fluid">
            <div class="row g-2 align-items-center">
              <div class="col-12 col-lg-3 text-center">
                <div id="timerDisplay" class="timer-display">0</div>
                <div class="mt-1">
                  <span class="badge text-bg-info me-1" id="suggestSeconds">משך מוצע: —</span>
                  <span class="badge text-bg-secondary badge-rounds" id="suggestRounds">סטים: 1</span>
                </div>
              </div>
              <div class="col-12 col-lg-6">
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                  <button class="btn btn-outline-light btn-wide" onclick="startTimer(1)">1 שנ׳</button>
                  <button class="btn btn-outline-light btn-wide" onclick="startTimer(3)">3 שנ׳</button>
                  <button class="btn btn-outline-light btn-wide" onclick="startTimer(5)">5 שנ׳</button>
                  <button class="btn btn-outline-light btn-wide" onclick="startTimer(10)">10 שנ׳</button>
                  <button id="startSuggestedBtn" class="btn btn-success btn-wide d-none" onclick="startSuggested()">
                    לפי התרגיל
                  </button>
                </div>
              </div>
              <div class="col-12 col-lg-3">
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                  <button class="btn btn-warning btn-wide" id="pauseBtn" onclick="togglePause()">PAUSE</button>
                  <button class="btn btn-danger btn-wide" onclick="resetTimer()">RESET</button>
                </div>
              </div>
            </div>
            <div class="text-center mt-1">
              <small class="text-light opacity-75">מקשים: Space = Pause/Resume, R = Reset</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- צליל סיום -->
  <audio id="beep" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== 7 קטגוריות + נתוני דוגמה =====
    const CATEGORIES = [
      "חימום כללי",
      "אירובי",
      "חימום ייעודי",
      "אימון כח",
      "אימון שיווי משקל",
      "אימון ליבה",
      "מתיחות"
    ];

    // תמונות דוגמה (לשימוש חוזר)
    const IMG_HAMSTRING = "https://www.inspireusafoundation.org/file/2023/09/seated-hamstring-stretch.gif";
    const IMG_CALF      = "https://www.inspireusafoundation.org/file/2022/12/wall-calf-stretch.gif";
    const IMG_SHOULDER  = "https://www.inspireusafoundation.org/file/2023/03/shoulder-rolls.gif";
    const IMG_DOORWAY   = "https://www.spotebi.com/wp-content/uploads/2015/01/doorway-stretch-exercise-illustration.jpg";

    // מילוי לדוגמה לכל טבלה (3 שורות כל אחת)
    const DATA = {
      "חימום כללי": [
        { muscle:"כללי", name:"March in Place", timeReps:"1 דקה × 1", instructions:"צעידה במקום, ידיים חופשיות", image:IMG_SHOULDER },
        { muscle:"כללי", name:"Arm Circles",    timeReps:"30 שניות × 2", instructions:"סיבובי כתפיים קדימה/אחורה", image:IMG_SHOULDER },
        { muscle:"כללי", name:"Hip Mobility",   timeReps:"30 שניות × 1", instructions:"סיבובי אגן והטיית אגן עדינה", image:IMG_CALF }
      ],
      "אירובי": [
        { muscle:"לב־ריאה", name:"Elliptical", timeReps:"5 דקות × 1", instructions:"קצב קל עד בינוני", image:IMG_CALF },
        { muscle:"לב־ריאה", name:"Bike",       timeReps:"5 דקות × 1", instructions:"סל״ד 80–90, התנגדות קלה", image:IMG_SHOULDER },
        { muscle:"לב־ריאה", name:"Rowing",     timeReps:"3 דקות × 1", instructions:"קצב אחיד, דגש על גב", image:IMG_HAMSTRING }
      ],
      "חימום ייעודי": [
        { muscle:"גב עליון", name:"Scapular Retraction", timeReps:"30 שניות × 2", instructions:"קירוב שכמות עם גב נייטרלי", image:IMG_SHOULDER },
        { muscle:"ירך אחורית", name:"Hamstring Prep",   timeReps:"20 שניות × 2", instructions:"כיפוף ירך קל, ללא כאב", image:IMG_HAMSTRING },
        { muscle:"שוק", name:"Calf Prep",                timeReps:"20 שניות × 2", instructions:"עמידה מול קיר, עקב צמוד לרצפה", image:IMG_CALF }
      ],
      "אימון כח": [
        { muscle:"ליבה", name:"Plank",              timeReps:"30 שניות × 3", instructions:"קו ישר ראש–עקבים, בטן אסופה", image:IMG_SHOULDER },
        { muscle:"רגליים", name:"Wall Sit",        timeReps:"40 שניות × 2", instructions:"גב צמוד לקיר, 90° בברכיים", image:IMG_CALF },
        { muscle:"גב", name:"Isometric Row Hold",   timeReps:"20 שניות × 3", instructions:"משיכה ואחיזה, שכמות לאחור", image:IMG_HAMSTRING }
      ],
      "אימון שיווי משקל": [
        { muscle:"קרסול/ליבה", name:"Single-Leg Stand", timeReps:"30 שניות × 2", instructions:"עמידה על רגל אחת, מבט קדימה", image:IMG_SHOULDER },
        { muscle:"קרסול", name:"Tandem Stance",          timeReps:"30 שניות × 2", instructions:"רגל מול רגל בקו אחד", image:IMG_CALF },
        { muscle:"ירך", name:"Cossack Hold (קל)",        timeReps:"20 שניות × 2", instructions:"העברת משקל לצד עם אחיזה נמוכה", image:IMG_HAMSTRING }
      ],
      "אימון ליבה": [
        { muscle:"ליבה", name:"Dead Bug (Isometric)", timeReps:"30 שניות × 2", instructions:"נשיפה, גב ניטרלי, תנועת יד/רגל נגדית בהחזקת זווית", image:IMG_SHOULDER },
        { muscle:"ליבה", name:"Hollow Hold (קל)",     timeReps:"20 שניות × 3", instructions:"אגן אחורה, צלעות למטה, החזק", image:IMG_CALF },
        { muscle:"ליבה", name:"Side Plank (ברך)",     timeReps:"20 שניות × 2", instructions:"מרפק מתחת לכתף, קו אוזן–כתף–אגן–ברך", image:IMG_HAMSTRING }
      ],
      "מתיחות": [
        { muscle:"חזה", name:"Doorway Stretch",      timeReps:"30 שניות × 2", instructions:"ידיים על משקוף מעל קו הכתפיים", image:IMG_DOORWAY },
        { muscle:"שוק", name:"Calf Stretch (Wall)",  timeReps:"30 שניות × 2", instructions:"עקב אחורי צמוד לרצפה, פעם ברך ישרה ופעם כפופה", image:IMG_CALF },
        { muscle:"ירך אחורית", name:"Seated Hamstring", timeReps:"30 שניות × 2", instructions:"רגל ישרה, גב ארוך, התקדמות עד מתיחה נוחה", image:IMG_HAMSTRING }
      ]
    };

    // ===== יצירת 7 הטבלאות בדף =====
    const sectionsRoot = document.getElementById("sections");

    CATEGORIES.forEach(cat => {
      const card = document.createElement("div");
      card.className = "card shadow-sm section-card";
      card.innerHTML = `
        <div class="card-header bg-white">
          <h4 class="mb-0">${cat}</h4>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover table-bordered text-center align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>שריר</th>
                  <th>שם תרגיל</th>
                  <th>זמן/חזרות</th>
                  <th>הוראות ביצוע</th>
                </tr>
              </thead>
              <tbody id="tbody-${slug(cat)}"></tbody>
            </table>
          </div>
        </div>
      `;
      sectionsRoot.appendChild(card);

      const tbody = card.querySelector(`#tbody-${slug(cat)}`);
      (DATA[cat] || []).forEach(ex => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${ex.muscle}</td>
          <td>${ex.name}</td>
          <td>${ex.timeReps}</td>
          <td>${ex.instructions}</td>
        `;
        tr.addEventListener("click", () => openExercise(ex));
        tbody.appendChild(tr);
      });
    });

    function slug(s){ return s.replace(/\s+/g,'-').replace(/[^\u0590-\u05FF\w-]/g,''); }

    // ===== פתיחת מודאל + הצעות זמן/סטים מהשדה =====
    const exerciseModal = new bootstrap.Modal(document.getElementById("exerciseModal"));
    let suggestedSeconds = null, suggestedRounds = 1;

    function openExercise(ex) {
      // תמונה/כותרת
      document.getElementById("modalImage").src = ex.image;
      document.getElementById("modalTitle").textContent = `הדגמת תרגיל: ${ex.name}`;

      // איפוס טיימר קיים
      resetTimer();

      // חישוב זמן מוצע/סטים
      const { seconds, rounds } = parseTimeReps(ex.timeReps);
      suggestedSeconds = seconds;
      suggestedRounds  = rounds;

      // הצגה
      document.getElementById("timerDisplay").textContent   = seconds || 0;
      document.getElementById("suggestSeconds").textContent = seconds ? `משך מוצע: ${seconds} שניות` : `משך מוצע: —`;
      document.getElementById("suggestRounds").textContent  = `סטים: ${rounds}`;
      document.getElementById("startSuggestedBtn").classList.toggle("d-none", !seconds);

      exerciseModal.show();
    }

    // תומך "דקות" וגם "שניות", ו־× סטים
    function parseTimeReps(str) {
      if (!str) return { seconds: 0, rounds: 1 };
      const minMatch = str.match(/(\d+)\s*(?:דק(?:ה|ות)?)/);  // 1 דקה, 5 דקות, דק
      const secMatch = str.match(/(\d+)\s*(?:שנ(?:י(?:ה|ות)?)?)/); // 30 שניות/שניה/ש׳
      const multMatch = str.match(/[×xX]\s*(\d+)/);
      const minutes = minMatch ? parseInt(minMatch[1],10) : 0;
      const secondsOnly = secMatch ? parseInt(secMatch[1],10) : 0;
      const seconds = minutes*60 + secondsOnly;
      const rounds  = multMatch ? parseInt(multMatch[1],10) : 1;
      return { seconds, rounds };
    }

    // ===== לוגיקת הטיימר בתוך המודאל =====
    let countdown = null, timeLeft = 0, isPaused = false, isRunning = false, remainingRounds = 1;

    function startTimer(seconds, rounds = 1) {
      resetTimer();
      remainingRounds = Math.max(1, rounds);
      timeLeft = seconds;
      isPaused = false;
      isRunning = true;
      document.getElementById("pauseBtn").textContent = "PAUSE";
      updateDisplay(timeLeft);
      countdown = setInterval(tick, 1000);
    }

    function startSuggested() {
      if (!suggestedSeconds) return;
      startTimer(suggestedSeconds, suggestedRounds);
    }

    function tick() {
      if (!isPaused && isRunning) {
        timeLeft--;
        updateDisplay(timeLeft);
        if (timeLeft <= 0) {
          playBeep();
          clearInterval(countdown); countdown = null;
          remainingRounds--;
          if (remainingRounds > 0) {
            setTimeout(() => {
              if (!isRunning) return;
              timeLeft = suggestedSeconds || timeLeft;
              updateDisplay(timeLeft);
              countdown = setInterval(tick, 1000);
            }, 800);
          } else {
            isRunning = false;
            document.getElementById("pauseBtn").textContent = "PAUSE";
            document.getElementById("timerDisplay").textContent = "✔️";
          }
        }
      }
    }

    function togglePause() {
      if (!isRunning) return;
      isPaused = !isPaused;
      document.getElementById("pauseBtn").textContent = isPaused ? "RESUME" : "PAUSE";
    }

    function resetTimer() {
      if (countdown) { clearInterval(countdown); countdown = null; }
      isPaused = false;
      isRunning = false;
      timeLeft = 0;
      remainingRounds = 1;
      updateDisplay(0);
      document.getElementById("pauseBtn").textContent = "PAUSE";
      stopBeep();
    }

    function updateDisplay(v) { document.getElementById("timerDisplay").textContent = v; }

    function playBeep() {
      const beep = document.getElementById("beep");
      beep.pause(); beep.currentTime = 0; beep.play().catch(()=>{});
    }
    function stopBeep() {
      const beep = document.getElementById("beep");
      beep.pause(); beep.currentTime = 0;
    }

    // ביטול הטיימר והצליל בעת סגירת פופאפ
    function onModalClose() {
      resetTimer();
      document.getElementById("modalImage").src = "";
    }

    // קיצורי מקלדת פועלים רק כשהמודאל פתוח
    document.addEventListener("keydown", (e) => {
      const isOpen = document.getElementById("exerciseModal").classList.contains("show");
      if (!isOpen) return;
      if (e.code === "Space") { e.preventDefault(); togglePause(); }
      if (e.key.toLowerCase() === "r") { resetTimer(); }
    });
  </script>
</body>
</html>
